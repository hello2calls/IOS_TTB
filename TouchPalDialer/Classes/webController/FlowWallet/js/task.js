function connectWebViewJavascriptBridge(callback) {	if (window.WebViewJavascriptBridge) {		callback(WebViewJavascriptBridge)	} else {		document.addEventListener('WebViewJavascriptBridgeReady', function() {								  callback(WebViewJavascriptBridge)								  }, false)	}}$(document).ready(function(){	var _token;	var URL;	var taskList;	var dataList = [];	var current_size;    _hmt.push(['_trackEvent', "redEnvelopes", "redEnvelopesOpen"]);	connectWebViewJavascriptBridge(function(bridge) {		  bridge.init(function(message, responseCallback) {					  responseCallback(data)		  });		  bridge.callHandler('getAuthToken',null, function(response){		  	//alert(response);		  	//_token取得    		//var _token = "d1e3de2b-5694-486d-a5a3-f39987c74477"		  	_token = response;		  	URL = "http://121.52.235.231:30011/voip/voip_task?_token=" + _token + "&_v=1&_type=0";    		$.ajax({				type:"GET",				url:URL,				dataType:"json",				success:function(data){					if(data.result_code == 2000){						var resInfo = data.result;												for(var i=0;i<resInfo.event.length;i++){							dataList.push({								event_id: resInfo.event[i].event_id, //活动编号								today_finish: resInfo.event[i].today_finish, //今天的该活动是否完成								today_finish_time: resInfo.event[i].today_finish_time, //今天完成的次数								bonus: resInfo.event[i].bonus, //此次活动能获取的奖励?								total_finish: resInfo.event[i].total_finish, //这期的该活动是否有完成								today_total_time: resInfo.event[i].today_total_time//今天能做的活动数上限							})						}						taskList = {							"available_event": resInfo.available_event, //今天还能参加的活动数							"available_bonus": resInfo.available_bonus, //今天还能获取的流量							"current_size": resInfo.current_size, //剩余流量							"data": dataList						}						if(allFinished("total_finish")){							$(".list").addClass("hide");							$(".loading").removeClass("hide");							count();							$(".count .finish p").text("太酷了！你已经完成了本期所有流量任务！");						}else{							count();							getTask();							$(".count p:first-child span").text(taskList.available_event);							$(".count p:nth-child(2) span").text(taskList.available_bonus + "MB");						}						current_size = taskList.current_size;                                          if(current_size == 0){                            showTxt("当前没有可提取的流量")                       }//                   else if(!allFinished("total_finish")){//                            showTxt("须完成全部任务才可以提取")//                       }                   else{                            $(".get").click(function(){                                       //提取流量                                _hmt.push(['_trackEvent', "redEnvelopes", "redEnvelopesGet"]);                                bridge.callHandler('openNewWeb','http://www.chubao.cn/s/flowwallet/liuliang_inapp_ios/pickup.html?current_size=' + current_size, function(response){                                                                                   });                            });                       }						$(".task li .undo").click(function(){							//去完成每日任务							var num = $(this).prev().html();							if ( num == 6 ){								bridge.callHandler('popShareView',{"type":"friend","title":"就是任性，亿兆流量免费送",								"msg":"免费的流量，你还不要？！","url":"http://www.baidu.com","headTitle":"发送流量红包给好友"}								, function(response){													});							}else if ( num == 7 ){								bridge.callHandler('popToRoot',null, function(response){								});							}						});					}else{						if(data.result_code == 4004){							console.log("请重新登录!")						}else if(data.result_code == 1001){							console.log("token无效!")						}else{							console.log("其他错误!")						}					}				}			});						$(".activity .undo").click(function(){			//去派发                _hmt.push(['_trackEvent', "redEnvelopes", "redEnvelopesDistribute"]);				bridge.callHandler('popShareView',{"type":"friend","title":"就是任性，亿兆流量免费送",				"msg":"免费的流量，你还不要？！","url":"http://www.baidu.com","headTitle":"发送流量红包给好友"}				, function(response){									});			});						$(".finish .friends").click(function(){			//去炫耀                _hmt.push(['_trackEvent', "redEnvelopes", "redEnvelopesShare"]);				bridge.callHandler('screenShotShare',null, function(response){				});			});		});	});		function allFinished(value){			var allFinish = true;			for(var i=0;i<taskList.data.length;i++){				switch(value){					case "today_finish":						if(!taskList.data[i].total_finish){							if(!taskList.data[i].today_finish){ allFinish = false; }						}						break;					case "total_finish":						if(!taskList.data[i].total_finish){ allFinish = false; }						break;					default:						break;				}			}			return allFinish;		}		function count(){			if(allFinished("today_finish") || allFinished("total_finish")){				$(".count .todo").addClass("hide");				$(".count .finish").removeClass("hide");				$(".count p").css("line-height","15px")			}else{				$(".count .todo").removeClass("hide");				$(".count .finish").addClass("hide");			}		}		function getTask_name(id){			var eventName = new Array();                  eventName['5'] = "注册触宝账号 30MB<br><span>仅针对新用户</span>";                  eventName['7'] = "用触宝打电话5MB<br><span>通话时长需一分钟以上</span>";                  eventName['8'] = "接管系统拨号 5MB<br><span>仅限Android系统</span>";                  eventName['6'] = "红包派发奖励5MB<br><span>需当日有人成功领取流量</span>";			if(eventName[id] != undefined){				return eventName[id]			}else{				return ""			}		}		function getTask(){			for(var i=0;i<taskList.data.length;i++){				var str1 = taskList.data[i].today_finish_time;				var str2 = taskList.data[i].today_total_time;				var class_color = "red";				var class_btnColor = "undo";				var status = "去完成";				if(!taskList.data[i].total_finish){					if(taskList.data[i].today_finish){						class_color ="gray";						class_btnColor = "do";						status = "已完成";					}					$(".task ul").append("<li><table><tbody><tr><td class='" +						class_color +						"' valign='top'>"+						"("+str1+"/"+str2+")"+						"</td><td valign='top'>" +						getTask_name(taskList.data[i].event_id) +						"</td><td valign='top'><span style='display:none'>"+taskList.data[i].event_id+"</span><div class='" +						class_btnColor +						"'>" +						status +						"</div></td></tr></tbody></table></li>"					)				}			}		}          function showTxt(text){            $(".get").attr("style","background-color: #ccc;cursor: default;padding: 5px");            $(".get").html("提取流量<br><span style='font-size:12px;display:block; '>("+ text +")</span>")          }		});